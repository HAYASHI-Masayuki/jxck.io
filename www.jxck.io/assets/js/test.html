<!DOCTYPE html>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>DEMO</title>

<style>
:root {
  --ui-back: #888;
  --ui-front: white;
}
h1 {
  background-color: #333;
  color: white;
  display: flex;
  justify-content: space-between;
}
background-fetch {
  display: block;
  width: 30px;
  height: 30px;
  color: white;
}
background-fetch::part(arrow) {
  fill: var(--ui-back);
}
background-fetch::part(arrow done) {
  fill: var(--ui-front);
}
background-fetch::part(base) {
  stroke: var(--ui-back);
  fill: transparent;
}
background-fetch::part(progress) {
  stroke: var(--ui-front);
  fill:transparent;
}
</style>

<h1>
  <a href=/>Test</a>
  <background-fetch
    class=disabled
    value=0
    size=34541742
    mtime=1581935516
    url=https://localhost.jxck.io:3000/pdf.pdf
    page=https://localhost.jxck.io:3000
    title="ep0 introduction"
  >
  </background-fetch>

</h1>

<script>
  'use strict';
  const $  = document.querySelector.bind(document)
  const $$ = document.querySelectorAll.bind(document)
  EventTarget.prototype.on = EventTarget.prototype.addEventListener

  async function enableBackgroundFetch(registration) {
    console.log('registration.backgroundFetch')
    const BackgroundFetch = await import('./background-fetch.js')
    customElements.define('background-fetch', BackgroundFetch.default)
  }

  document.on('DOMContentLoaded', async (e) => {
    console.log(e)
    const registration = await navigator.serviceWorker.register('test.sw.js', { scope: '/' })
    await navigator.serviceWorker.ready
    await enableBackgroundFetch(registration)
  })
</script>
