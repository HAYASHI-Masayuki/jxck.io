<!DOCTYPE html>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">

<meta http-equiv=origin-trial content="Anha8n5weiE1qmmioiu3ohgnpbUHsZXnFDiI8DtT8BWr8qp5y/dAYYBOgNclM4Gj0DSKtmCzHFqg9oea3q3aNA4AAABfeyJvcmlnaW4iOiJodHRwczovL2p4Y2suaW86NDQzIiwiZmVhdHVyZSI6IlRydXN0VG9rZW5zIiwiZXhwaXJ5IjoxNjAyMDU5NzQxLCJpc1N1YmRvbWFpbiI6dHJ1ZX0=">

<title>Trust Token Issuer DEMO</title>

<style>
pre {
  background-color: #ccc;
}
</style>

<h1>Trust Token Issuer DEMO</h1>

<p>Are you a human ?</p>
<button id=yes>Yes</button>

<pre>
</pre>

<script>
  'use strict';
  const $  = document.querySelector.bind(document)
  const $$ = document.querySelectorAll.bind(document)
  EventTarget.prototype.on = EventTarget.prototype.addEventListener


  const ISSUER = 'https://labs.jxck.io'
  const protocol_version = "TrustTokenV1"
  const batchsize        = 10
  const expiry           = "1622574000000000"


  const srrkey = 'gWWrw3Vw25y/MAo6sqx3/XF2aTTm8qAeACP5ry8ApBs='
  const Y = 'AAAAAQBhBDLlLwOnKkSMQd2Mgrgjso60I9NKEjbuhic5Nh/GRepS7wDf/2K0hnQT5URebuLFdHOZ7lpHjrnhMj46TvjfUcl7SGSuMbwiepDbIo+I5RCfotxvzRL/1eQJoNAeW1IIoQBhBAmYZcJpetEivsRpR0i3Yw86xHni6CZXuMUeQ+agO5URp1/o7GSTxoCFOVQAhtLWRnQ2FESH0m6gSQxNfcfrwWsMwzZ0Isf/OBo7qayykXWDD9sZsFxYfFwoFyyC5+jS3ABhBGOvKq7JRZ4QTsi5cre4JO78NnRV24wVhffushArrAMdekBEb2tY+rfYXhNsUU0bWKQq6ad8omsPlwPkLSjcGWr5UIm7+5olQ3snqo0dOFt4XfkFxW5x0siayVbaJZP49Q=='



  const COMMITMENT = {}
  COMMITMENT[ISSUER] = {
    protocol_version,
    batchsize,
    srrkey,
    "1": { Y, expiry }
  }

  const CMD = `/Applications/Google\\ Chrome\\ Canary.app/Contents/MacOS/Google\\ Chrome\\ Canary \\
  --additional-trust-token-key-commitments='${JSON.stringify(COMMITMENT)}' \\
  --auto-open-devtools-for-tabs \\
  --log-net-log=./trust_token_chromium_netlog.json \\
  --enable-logging=stderr \\
  --v=1 \\
  https://labs.jxck.io/trust-token/issuer.html \\
  &gt; canary_debuglog.txt 2&gt;&amp;1
  `


  document.on('DOMContentLoaded', async (e) => {
    console.log(e)

    $('pre').innerHTML = CMD;

    $('#yes').on('click', async () => {
      const res = await fetch(`/.well-known/trust-token`, {
        method: 'POST',
        trustToken: {
          type: 'token-request',
          issuer: ISSUER,
        }
      })

      console.log(res)
    })

    const token = await document.hasTrustToken(ISSUER)
    console.log(token)
  })
</script>
