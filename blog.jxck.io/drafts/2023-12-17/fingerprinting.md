
## Fingerprinting

3rd Party Cookie が無くても、トラッキングできると謳う製品の大半は、 Fingerprinting に依存している可能性が高い。

Fingerprinting は、ブラウザから取得できる情報をかき集めることで、ユーザごとに微妙に違う部分を手がかりに、ユーザを区別するという手法全般を指す。

この手法の精度は、いかにエントロピーの高い情報をブラウザから取得できるかにかかっている。そして、そのベースとなる情報は IP と User-Agent だろう。

IP だけでもかなり絞り込めはするが、同一ネットワークにいると同じ IP をポートを分けて使い回したり、時間が経つと別の人に割り当てられたりする。逆に同じ端末では、ブラウザが変わっても IP は変わらないだろう。従って IP のみで完璧な区別を実現できるとはいいがたい。

`User-Agent` 文字列は、使ってるマシンやブラウザ、そのバージョンなど細かい情報が入ってるため、同じネットワークにいても、 使っている OS やブラウザが違うと異なる値になる。

大抵はこの 2 つをベースにし、さらに精度を上げるための情報を追加で集めていく。例えば、デバイス固有な情報として `Accept-Language` の設定言語や、ローカルに保存されてるフォント情報、接続されたデバイス情報、 WebRTC や Canvas などエントロピーの高い情報が取得可能な API のコール結果などだ。

こうした Fingerprinting を防ぐ実装も、続々とブラウザに入っている。


### IP の秘匿

まず Apple が公開した IP への対応が、 Private Relay だ。これは Proxy を経由することで、サーバに見えるクライアントの IP を Proxy の IP に変えてしまうというものだ。インフラを利用するため有料ではあるが、 IP さえ変わってしまえばほとんど解決といってもいいレベルだろう。

Mozilla や Brave は VPN を提供することで同等のことを実現している。

また、 IP の秘匿を標準にするために、 IETF では OHTTP という仕様の標準化作業を行っており、 Chrome や Firefox が Proxy としての Fastly などと組んで対応していく予定を公開している。


## User-Agent String Reduction

`User-Agent` はそもそも情報量が多すぎることが度々問題になっている。

元々は、当時使われていた HTML の `<frame>` が、 Netscape では対応されていたが、 Mosaic は対応していなかった。そこで Web 開発者は、 Netscape か Mosaic かで分岐し `<frame>` の出し分けをしていた。そこに後発の IE が登場した時に `<frame>` に対応している分岐に入るために、 Netscape のふりをする必要があった。そうやって嘘を重ねた結果、今日に至る非常に長い UA 文字列が出来上がったのだ。

しかし、今では機能に対する分岐は Feature Detection が基本になるため、 UA の蓄積は一掃したい負債でもあった。そこで、今ではこのヘッダのエントロピーを下げていくための取り組みが始まっている。

Safari の場合は Version の値などを固定していくとで、以降のバージョンで文字列の変化する部分を減らすという "Freezing User-Agent" という取り組みが始まっている。もちろん、細かいバージョンが取れなくなると困るケースもあるが、大抵は特定バージョンのバグに起因する分岐であり、リリースサイクルが短くなったことでその影響も小さくなっている。

他のブラウザも概ね同意しており、 UA の代替としてもっと正確な情報を必要に応じて必要なだけ取る `Sec-CH-UA` を仕様化し、 Chrome を筆頭に対応が進んでいる。これは、デフォルトのいくつか以外は勝手には送られず、またブラウザも絞った情報しか出さないといったことで、 UA のようなことが起こらないようにしている。

