# [cookie][3pca] 3PCA 9 日目: DNT

## Intro

このエントリは、 3rd Party Cookie Advent Calendar の 9 日目である。

- 3rd Party Cookie のカレンダー | Advent Calendar 2023 - Qiita
  - https://qiita.com/advent-calendar/2023/3rd-party-cookie

今回は、 P3P の後に提案され、非常に似たコンセプトかつ最近まで使われていた DNT について解説する。

## トラッキング問題の表面化

2000 年代に入って、「なんかトラッキングされてて気持ち悪いなぁ」っていうユーザの気持ちはうっすらあったけど、これを問題として決定づける大きな事件がいくつかあったんだよね。

例えば、 2000 年に Double Click っていう、後に Google が買収する大手広告ネットワークが、あるマーケティング会社を買収するんだけど、そのマーケ会社がもってる実名データベースと Double Click のトラッキングしたデータを紐づけて、「区別」を「識別」にしようとして怒られたんだよね。

あと、 2007 年には Facebook が、他のサービスでのアクティビティを FB に勝手に共有する Facebook Beacon ってサービスをやろうとして、それがデフォルト有効の Opt-Out 方式だったために、「俺が Ebay で買った秘密の買い物が友達にバレたらどうするんだ！」みたいに大炎上した。

そんなこんなで、アメリカではユーザっていうか消費者代表が、議会を巻き込んで政治の話にまで発展したんだよね。

## Tracking からの Opt-Out

Opt-Out には、基本的に三つの方法がある。

1.  Opt-Out してます、っていう Cookie を保存して、それを送られた広告ネットワークはトラックしない

2.  トラッキングしてる業者のリストを作って、それをブラウザなどに読み込んで設定する

3.  ブラウザから「Opt-Out してます」っていう HTTP Header とかを送る

で、当時の広告会社がやっていたのは、もちろん 1 だったんだよね。

「うちは、この画面に来てボタンをクリックしてくれればオプトアウトできるようになってますよー」みたいな。

でも、そういう業者が何百もあって、ユーザはそれぞれ全部を巡回して Cookie を集めて回らないといけない。Cookie はそのドメインにしか送られない仕様上、一個保存して全部オプトアウトとかできない。

しかも、その Cookie もあくまでただの Cookie だから、どこかで消える。むしろ、プライバシーに敏感で、毎回 Cookie を削除してるようなユーザは、そのタイミングでオプトアウト Cookie も消えてしまうわけだ。

## Do Not Track List

そんななか怒ったユーザは、アメリカの FTC (連邦取引委員会) ってところに、 「**Do Not Track リストを作れ！**」って要求する苦情を出したんだよね。これはもともと、アメリカで電話セールスをするには番号を届けないといけなくて、その番号リストをとってきて電話だかに設定すると電話セールス全部お断りってできる仕組みがあったんだ。これが Do Not Call リストで、そのドメイン版を作れっていう意味だったんだね。つまり 2 番の方法だ。

とはいえ、いきなり全部リストにするのは難しいので「お前らもうちょっとポリシーちゃんとして自粛しなさい」ってお達しを出したおかげで、各社が Privacy Policy 的なものをお達しに合わせて整理した。

## Do Not Track Header

でもやっぱりオプトアウト Cookie じゃだめってなった。そこで、 IE は 2 番のリストを IE9 に実装してリリースしたんだ。でもそのリストをメンテし続けるのも難しい。

そこで、ブラウザから HTTP ヘッダで明示的に示せるようにして、広告会社側がそれを見るようにしようってことで、提案されたのが DNT ヘッダなんだね。

`DNT: 1`

1 だと拒否、 0 だと許可。めっちゃシンプルなヘッダ。

最初に Mozilla が実装したのをきっかけに、 IE, Safari, Chrome, Opera と、次々と実装していくことになる。

「トラッキングを無効にする」みたいなオプションを有効にすれば、このヘッダが飛ぶようになったから、ユーザの意図は示せた。

あとは、このヘッダを見る広告側の問題だ。

## 広告側の対応

結果から言うと、誰もまともにこのヘッダに対応しなかった。

Yahoo や Google などの大手も、 Privacy Policy の中に「DNT があってもうちは見てません」みたいなことをはっきりと明示するレベルで、みんな無視してたんだね。

広告側には広告側の言い分があって

「そもそも DNT で何をオプトアウトしたいのか(トラッキングが嫌なのか、パーソナライズが嫌なのか)ユーザは本当にわかってるかあやしい」

「無料で運営しているサイトが収益化する方法がなくなると、インターネットは立ち行かなくなる」

などなど

結果、 DNT はプライバシー意識の高い人によって虚空に投げられるだけのヘッダになってしまった。

## DNT as Fingerprint Vector

DNT が送られた側によってまったく考慮されてないのに、ただただ送ってるだけに状態になってひさしいんだけど、これが逆に問題になるんだよね。

例えば、送ってない大半の人のリクエストがこうだったとして

`GET / HTTP/1.1
Host: example.com
Accept: text/html
Accept-Language: ja-JP`

その中で 1000 人に一人くらいが DNT を送っていたとする

`GET / HTTP/1.1
Host: example.com
Accept: text/html
Accept-Language: ja-JP
DNT: 1`

すると、どう考えても逆に目立つよね。

「Cookie を使わずにユーザを区別できないか」ってときに、「他の人と異なる部分」があればあるほど区別の精度が上がるので、 DNT を送る方が区別するための要素に使えてしまうんだよね。

専門用語で言うと、エントロピーが上がって Fingerprint ベクターになるっていうやつ。

後にプライバシーうるさ方ブラウザの筆頭になる Safari は、「DNT は Fingerprint に使われる以外に用途がなくなったので、もう送らん」ってことで、ブラウザから機能を削除しちゃったんだね。2019 年だからだいぶ後の話だけど。

- Safari 12.1 Release Notes | Apple Developer Documentation

  - [https://developer.apple.com/documentation/safari-release-notes/safari-12_1-release-notes](https://developer.apple.com/documentation/safari-release-notes/safari-12_1-release-notes "https://developer.apple.com/documentation/safari-release-notes/safari-12_1-release-notes")

Chrome, Firefox, Edge はまだ送るためのオプションがあるけど、これも次提案された Global Privacy Control によって消えていくかもね。その話はまたいずれ。

まとめると

- サードパーティー Cookie ではなく、トラッキングからオプトアウトしたいという話はずっとあった

- DNT はそれを示すヘッダだったけど、広告側が誰もまともに対応しなかった

- 形骸化して消えつつあるの、失敗したと言える

でも、まだまだトラッキングとの戦いは続くよ！
